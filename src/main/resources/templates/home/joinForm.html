<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>회원가입 페이지</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>

    <script>
        $(function(){

            function bindFormSubmit() { // 개인,기업 로그인 버튼 누를때마다 폼이 바뀔때 이벤트도 같이 제거/생성 하는 바인딩


                // 기존 RegularJoinProcess 폼 처리
                $('form[name="regularJoinProcess"]').off('submit').on('submit', function (e) {
                    e.preventDefault(); // 기본 폼 제출 동작 막기

                    $.ajax({  //로그인 버튼으로 폼이 바뀔때 이벤트도 바뀌므로 제출 누를때 joinProcess도 ajax로 가져옴
                        url: $(this).attr('action'), // form의 action 속성에서 URL 가져오기
                        method: 'POST', // POST 방식 지정
                        data: $(this).serialize(), // form 데이터를 직렬화하여 전송
                        success: function (response) {
                            alert("회원가입에 성공하셨습니다!");
                            // 성공 후 리디렉션 등 추가 처리
                            window.location.href = 'login';
                        },
                        error: function () {
                            alert("회원가입에 실패했습니다.");
                        }
                    });
                }); // 새로 로드된 regularJoinProcess 폼 처리하는 메서드 끝


                // 새로 로드된 BusinessJoinProcess 폼 처리
                $('form[name="businessJoinProcess"]').off('submit').on('submit', function (e) {
                    e.preventDefault(); // 기본 폼 제출 동작 막기

                    $.ajax({  //로그인 버튼으로 폼이 바뀔때 이벤트도 바뀌므로 제출 누를때 joinProcess도 ajax로 가져옴
                        url: $(this).attr('action'), // form의 action 속성에서 URL 가져오기
                        method: 'POST', // POST 방식 지정
                        data: $(this).serialize(), // form 데이터를 직렬화하여 전송
                        success: function (response) {
                            alert("기업 회원가입에 성공하셨습니다!");
                            // 성공 후 리디렉션 등 추가 처리
                            window.location.href = 'login';
                        },
                        error: function () {
                            alert("기업 회원가입에 실패했습니다.");
                        }
                    });
                }); // 새로 로드된 businissJoinProcess 폼 처리하는 메서드 끝

            }




            $(document).on('click', '.BusinessJoinBtn', function () {  //회원가입 페이지에서 기업 버튼 누르면 기업회원가입 페이지로 변경
                $.ajax({
                    url: 'businessJoinForm',
                    method: 'get',
                    success: function(response) {
                        $("#replaceJoinContent").html(response);
                        bindFormSubmit();
                    },
                    error: function() {
                        alert("기업회원가입 페이지 불러오는 ajax 오류임 - 스크립트");
                    }
                });
            }); //회원가입 - 기업가입 버튼 변경 끝


            $(document).on('click', '.RegularJoinBtn', function () { //회원가입 페이지에서 개인 버튼 누르면 기업회원가입 페이지로 변경
                $.ajax({
                    url: 'regularJoinForm',
                    method: 'get',
                    success: function(response) {
                        $("#replaceJoinContent").html(response);
                        bindFormSubmit();
                    },
                    error: function() {
                        alert("개인회원가입 페이지 불러오는 ajax 오류임 - 스크립트");
                    }
                });
            }); //회원가입 - 개인가입 버튼 변경 끝


        });
    </script>

</head>
<body>

<div id="replaceJoinContent">
<th:block th:replace="~{fragments/regularJoinForm}"/>
</div>

</body>
</html>