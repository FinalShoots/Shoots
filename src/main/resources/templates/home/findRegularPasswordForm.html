<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{fragments/header :: header}"/>
    <meta charset="UTF-8">
    <title>아이디 찾기</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>

    <script>
        $(document).ready(function () {
            $('#startQuery').on('click', function () {
                const userId = document.getElementById('user_id').value;
                const email = document.getElementById('email').value;

                $.ajax({
                    url: 'checkRegularUserWithIdAndEmail',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ user_id: userId, email: email }),
                    success: function (data) {
                        if (data.success) { //id,email이 일치하는 데이터가 있으면 ?
                            document.querySelectorAll('.afterStartQuery').forEach(el => {
                                el.style.display = 'block';
                                document.querySelector('#startQuery').style.display = 'none';
                                document.querySelector('.beforeUpdatePassword').style.display = 'none';
                            });
                            alert('해당 이메일로 인증번호를 발송했습니다. \n해당 인증번호를 아래의 인증번호란에 입력해주세요.')
                        } else { //일치하는 데이터가 없으면
                            alert('아이디 또는 이메일이 일치하지 않습니다.');
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('Error:', error);
                        alert('요청 처리 중 문제가 발생했습니다. 서버 상태를 확인하세요.');
                    }
                });
            }) //startQuery click 함수 끝


        });
    </script>


</head>
<body>

<div class="container">

    <div >
        <span>가입하실때 사용하신 회원님의 아이디와 이메일을 적어주세요.</span>
        <br>
        <b>아이디</b>
        <input type="text" id="user_id" name="user_id" placeholder="아이디를 입력해 주세요." maxLength="30" required>
        <br>
        <b>이메일 주소</b>
        <input type="text" id="email" name="email" placeholder="이메일을 입력해 주세요." maxLength="30" required>
        <br>
        <button type="button" id="startQuery" style="color:blue">검색</button>
        <br>
        <span class="beforeUpdatePassword">| 검색을 누르면 잠시 후 알림창이 뜨니 조금만 기다려주세요. |</span>
    </div>


    <form th:action="@{/verifyNumberProcess}" method="post">
        <div class="afterStartQuery" style="display:none;">
            <b>인증번호</b>
            <input type="text" name="verifyNumber" placeholder="인증번호를 입력해 주세요." maxLength="6" required>
        </div>
        <button type="submit" class="afterStartQuery" style="display:none;">입력</button>
    </form>
</div>
<br>
<a th:href="@{/findRegularId}">아이디 찾기</a>


</body>
<th:block th:replace="~{fragments/footer :: footer}"/>
</html>